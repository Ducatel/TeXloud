
<?php

   session_start();
   $pdo_options[PDO::ATTR_ERRMODE] = PDO::ERRMODE_EXCEPTION;
   
   $bdd = new PDO('mysql:host=localhost;dbname=Texloud', 'root', 'debouz1990', $pdo_options);



  // On met les variables utilisé dans le code PHP à FALSE (C'est-à-dire les désactiver pour le moment).
  $error = FALSE;
  $registerOK = FALSE;
             
            
   
	
  try
      { 
	 
	    $reponse = $bdd->prepare('SELECT identifiant,motpasse,salt FROM utilisateur WHERE identifiant = ?');
	    $reponse->execute(array($_POST['identifiant']));
	    $req=$reponse->fetch(PDO::FETCH_OBJ);

	    $salt=$req->salt;
	   
	    $motpasse=$req->motpasse;
	    $motpassuser=sha1($_POST['motpasse'].$salt);
	  
	  if($motpasse == $motpassuser){
		  $registerOK = TRUE;
	      	  $_SESSION["identifiant"] = $_POST["identifiant"];
		  $_SESSION["motpasse"] = $_POST["motpasse"];
		  $_SESSION['identifiant']=$_POST['identifiant'];
	    }
	
	  else {
			  $error = TRUE;
			  $errorMSG = "Tout les champs doivent être remplis !";
			  $motpasse = NULL;
		}
	  $reponse->closeCursor(); // Termine le traitement de la requête
	  }
 
               
  catch(Exception $e)
      {
	  // En cas d'erreur précédemment, on affiche un message et on arrête tout
	  die('Erreur : '.$e->getMessage());
      }



  if($error == TRUE){ 
     ?>
        <p>
         <?php  echo "<p>Tout les champs doivent être remplis !</p>";?><br />
               
        </p>
    <?php
    
    header('Location: Acceuil.html');
  }

  if($registerOK == TRUE){ 
    ?>
        <p>
         <?php echo "<p>".$registerMSG."</strong></p>";?><br />
               
        </p>
    <?php
       
      $_SESSION['last_access']=time();
      $_SESSION['ipaddr']=$_SERVER['REMOTE_ADDR'];
      
         
     header('Location: texloud.php'); 

   }

?>